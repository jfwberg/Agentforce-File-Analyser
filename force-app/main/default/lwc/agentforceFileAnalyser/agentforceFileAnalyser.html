<template>

    <lightning-spinner 
        lwc:if          = {loading}
        alternative-text= "Loading" 
        size            = "medium"
        variant         = "base"
    ></lightning-spinner>

    <!-- MAIN CARD -->
    <lightning-card title="Upload file to analyse" icon-name="standard:bot">
        <div class="slds-card__body">
            <div class="slds-var-p-around_small">
                <fieldset class="slds-box">
                    <legend class="legend">Input</legend>

                    <lightning-combobox
                        label    = "Model"
                        value    = {modelSelected}
                        options  = {modelOptions}
                        onchange = {handleChangeModel}
                        variant  = "label-inline"
                    ></lightning-combobox>
                    
                    <lightning-input
                        name            ="question"
                        value           ={question}
                        label           ="Question"
                        onchange        ={handleChangeQuestion}
                        field-level-help="Ask a question about the uploaded file"
                        disabled        = {questionDisabled}
                        variant         = "label-inline"
                    ></lightning-input>

                    <lightning-input
                        type            = "checkbox"
                        name            = "extractTables"
                        value           = {extractTables}
                        label           = "Extract Tables"
                        onchange        = {handleChangeExtractTables}
                        field-level-help= "Checking this option will extract the tables from a document"
                        disabled        = {fileUploadDisabled}
                        variant         = "label-inline"
                    ></lightning-input>

                    <lightning-file-upload
                        label           = "Upload File"
                        name            = "fileUploader"
                        accept          = {acceptedFormats}
                        onuploadfinished= {handleUploadFinished}
                        disabled        = {fileUploadDisabled}
                        multiple        = false
                    ></lightning-file-upload>

                </fieldset>

                <fieldset class="slds-box box-padding">
                    <legend class="legend">Uploaded file info</legend>
                    <div lwc:if={documentInfoVisible}>
                        <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                            <tr>
                                <td>Document Id:</td>
                                <td>{document.id}</td>
                            </tr>
                            <tr>
                                <td>Document Name:</td>
                                <td>{document.name}</td>
                            </tr>
                            <tr>
                                <td>Document Status:</td>
                                <td>{document.status}</td>
                            </tr>
                            <tr>
                                <td>Document Content Body Id:</td>
                                <td>{document.contentBodyId}</td>
                            </tr>
                            <tr>
                                <td>Document Content Version Id:</td>
                                <td>{document.contentVersionId}</td>
                            </tr>
                        </table>
                    </div>
                </fieldset>

                <fieldset class="slds-box box-padding">
                    <legend class="legend">LLM Response</legend>
                    <div lwc:if={showResponse}>
                        <div class="slds-scrollable_x" style="max-width: 100%;">
                            <table class="slds-table slds-table_cell-buffer slds-table_bordered wrapped-text" style="table-layout: auto; max-width: 100%;">
                                <tr>
                                    <td>Model Name:</td>
                                    <td>{response.modelName}</td>
                                </tr>
                                <tr>
                                    <td>Prompt Template:</td>
                                    <td>{response.promptTemplateName}</td>
                                </tr>
                                <tr>
                                    <td>Question:</td>
                                    <td>{response.question}</td>
                                </tr>
                                <tr>
                                    <td>Extract Table:</td>
                                    <td>{response.extractTables}</td>
                                </tr>
                                <tr>
                                    <td>Tables found:</td>
                                    <td>{tablesFound} ({numberOfTables})</td>
                                </tr>
                                <tr>
                                    <td>Category:</td>
                                    <td>{category}</td>
                                </tr>
                                <tr>
                                    <td>Summary:</td>
                                    <td style="word-wrap: break-word; white-space: normal;">{summary}</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div lwc:if={showLlmResponse}>
                            <pre class="wrapped-text slds-box">{response.llmResponse}</pre>
                        </div>                        
                        
                        <div lwc:if={response.extractTables}>
                            <template for:each={tables} for:item="datatable">
                                <div class="slds-scrollable_x" style="max-width: 100%;" key={datatable.name}>
                                    <c-llm-datatable tabledata={datatable}></c-llm-datatable>
                                </div>
                            </template>
                        </div>
                    </div>
                </fieldset>

            </div>
        </div>
    </lightning-card>

</template>